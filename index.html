<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="data:,">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Inicio - Tienda</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    /* ---------- CARRUSEL DESTACADOS (estilos propios) ---------- */
    .section-title {
      text-align: center;
      font-size: 1.4rem;
      font-weight: 900;
      color: #1B142E;
      letter-spacing: -0.3px;
    }
    .section-title .subline {
      display: block;
      font-weight: 600;
      font-size: 0.95rem;
      color: #555;
      opacity: 0.9;
    }

    .carousel-root {
      width: 100%;
      max-width: 1200px;
      margin: 0.6rem auto 1.4rem auto;
      position: relative;
      overflow: visible;
      padding: 0 8px;
    }

    .carousel {
      display: flex;
      align-items: stretch;
      gap: 1rem;
      background: transparent;
      border-radius: 12px;
      overflow: visible;
      height: 620px; /* altura desktop */
      box-shadow: 0 8px 28px rgba(0,0,0,0.08);
    }

    .slide {
      display: flex;
      width: 100%;
      align-items: stretch;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    .slide-media {
      flex: 0 0 60%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f2f2f2;
      overflow: hidden;
      min-height: 100%;
      position: relative; /* para overlay */
    }
    .slide-media img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 300ms ease;
    }

    .media-overlay {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.6rem;
      padding: 0.6rem 1rem;
      background: rgba(0,0,0,0.42);
      color: white;
      backdrop-filter: blur(4px);
      border-top-left-radius: 0;
      border-top-right-radius: 0;
    }
    .media-overlay .overlay-title {
      font-weight: 800;
      font-size: 1rem;
      line-height: 1.05;
    }
    .media-overlay .overlay-actions {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .media-overlay .overlay-price {
      font-weight: 800;
      font-size: 0.95rem;
      color: #fff;
      opacity: 0.98;
      margin-right: 0.6rem;
    }
    .media-overlay .overlay-add {
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.18);
      color: white;
      padding: 0.4rem 0.65rem;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
    }
    .media-overlay .overlay-add:hover {
      background: rgba(255,255,255,0.18);
    }

    .slide-content {
      flex: 1;
      padding: 2.2rem 1.8rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 0.9rem;
    }
    .slide-title {
      font-size: 1.6rem;
      font-weight: 800;
      color: #1B142E;
      margin-bottom: 0.2rem;
    }
    .slide-desc {
      font-size: 1rem;
      color: #444;
      line-height: 1.45;
      max-height: 7.2rem;
      overflow: hidden;
    }

    .slide-actions {
      margin-top: 0.8rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .slide-actions .precio {
      font-weight: 900;
      font-size: 1.05rem;
      color: #1B142E;
      margin-left: auto;
    }
    .slide-actions .add-btn {
      background: #D45510;
      color: white;
      border: none;
      padding: 0.6rem 0.9rem;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
    }

    /* Flechas nav */
    .nav-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      border-radius: 8px;
      background: rgba(27,20,46,0.10);
      color: rgba(27,20,46,0.9);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor: pointer;
      z-index: 30;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      transition: transform 0.12s ease, background 0.12s ease, color 0.12s ease;
      user-select: none;
      border: 1px solid rgba(27,20,46,0.06);
    }
    .nav-arrow:hover {
      transform: translateY(-50%) scale(1.06);
      background: rgba(27,20,46,0.18);
      color: white;
    }
    .nav-left { left: 8px; }
    .nav-right { right: 8px; }

    /* Indicadores (dots) */
    .carousel-dots {
      display:flex;
      gap:0.5rem;
      justify-content:center;
      margin-top:0.8rem;
    }
    .carousel-dots button {
      width:10px;height:10px;border-radius:50%;border:none;background:rgba(0,0,0,0.14);cursor:pointer;
    }
    .carousel-dots button.active { background:#1B142E; transform:scale(1.15); }

    /* ---------- VERSION MOVIL ---------- */
    @media (max-width: 768px) {
      .carousel { height: auto; }
      .slide { flex-direction: column; height: auto; }
      .slide-media { flex: none; width: 100%; height: 62vw; }
      .slide-media img { width: 100%; height: 100%; object-fit: cover; }
      .slide-content {
        padding: 0.6rem 1rem 1rem 1rem;
        text-align: center;
      }
      .slide-title { font-size: 1.05rem; }
      .slide-desc { display: none; }
      .slide-actions { justify-content: center; gap: 0.6rem; }
      .slide-actions .precio { margin-left: 0; display: none; }
      .nav-left { left: 8px; }
      .nav-right { right: 8px; }
      .nav-arrow { width:40px; height:40px; font-size: 1.05rem; }
      .carousel-root { padding: 0 0.5rem; }

      /* mostramos el overlay en m√≥vil */
      .media-overlay { display:flex; }
    }

    /* En desktop ocultamos el overlay por defecto (s√≥lo m√≥vil lo muestra) */
    @media (min-width: 769px) {
      .media-overlay { display: none; }
    }

    /* ---------- SOBRE NOSOTROS ---------- */
    .about {
      max-width: 1000px;
      margin: 1.6rem auto;
      padding: 1.6rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      color: #222;
      line-height: 1.6;
      text-align: left;
    }
    .about .about-inner {
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 1.2rem;
      align-items: center;
    }
    .about h2 {
      font-size: 1.25rem;
      color: #1B142E;
      margin-bottom: 0.6rem;
      text-align: center;
      letter-spacing: 0.6px;
      font-weight: 900;
    }
    .about .lead {
      font-weight: 700;
      font-size: 1.02rem;
      color: #333;
      margin-bottom: 0.6rem;
    }
    .about .mission {
      background: linear-gradient(180deg, rgba(212,85,16,0.06), rgba(0,0,0,0.02));
      border-left: 4px solid rgba(212,85,16,0.9);
      padding: 0.8rem;
      border-radius: 8px;
    }
    @media (max-width: 900px) {
      .about .about-inner { grid-template-columns: 1fr; }
      .about h2 { text-align: left; }
    }

    .values { max-width: 1000px; margin: 1rem auto 2rem; display:grid; grid-template-columns: repeat(3,1fr); gap:0.9rem; }
    @media (max-width:900px){ .values { grid-template-columns: 1fr; } }

    .sr-only { position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
  </style>
</head>
<body>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      document.body.classList.add('loaded');
    });
  </script>

<div id="header-container"></div>
<script type="module">
  import { iniciarHeaderConFirebase } from './header.js';

  document.addEventListener('DOMContentLoaded', () => {
    iniciarHeaderConFirebase();
  });
</script>

  <main>
    <!-- T√çTULO DE LA ZONA DE PRODUCTOS -->
    <h2 class="section-title">PRODUCTOS DESTACADOS <span class="subline">Lo mejor para tus celebraciones</span></h2>

    <!-- CARRUSEL DESTACADOS - primero en la p√°gina -->
    <section class="carousel-root" aria-label="Productos destacados">
      <div id="carousel" class="carousel" role="region" aria-roledescription="slide"></div>

      <!-- flechas -->
      <button id="prevBtn" class="nav-arrow nav-left" aria-label="Anterior">‚óÄ</button>
      <button id="nextBtn" class="nav-arrow nav-right" aria-label="Siguiente">‚ñ∂</button>

      <!-- dots -->
      <div id="carouselDots" class="carousel-dots" aria-hidden="false"></div>
    </section>

    <!-- SOBRE NOSOTROS -->
    <section class="about" aria-labelledby="sobre-title">
      <h2 id="sobre-title">SOBRE NOSOTROS</h2>
      <div class="about-inner">
        <div>
          <p class="lead"><strong>Somos un emprendimiento dedicado a crear productos decorativos para fiestas y juegos did√°cticos, dise√±ados con creatividad, pasi√≥n y un toque nacional.</strong></p>

          <p>Nos destacamos por ofrecer art√≠culos fabricados localmente, con dise√±os √∫nicos que aportan valor, diversi√≥n y significado a cada celebraci√≥n.</p>

          <div class="mission">
            <p><strong>Nuestra misi√≥n:</strong> Llevar alegr√≠a y originalidad a cada evento mediante productos de calidad, accesibles y con identidad.</p>
            <p><strong>Visi√≥n:</strong> Ser una referencia nacional en dise√±o festivo y productos did√°cticos, apoyando talento local y pr√°cticas sostenibles.</p>
          </div>
        </div>

        <div>
          <div style="background:linear-gradient(135deg,#fff,#f8f8f8); border-radius:10px; padding:1rem; text-align:center;">
            <p style="margin:0; font-weight:800; color:#1B142E;">Calidad & Dise√±o Local</p>
            <p style="margin:0.6rem 0 0 0; color:#555;">Apoyamos la producci√≥n local y el detalle en cada pieza.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- peque√±os valores -->
    <section class="values" aria-label="Por qu√© elegirnos">
      <div class="value-card">
        <div class="icon">üé®</div>
        <h4>Dise√±o creativo</h4>
        <p>Productos pensados para destacar en cualquier celebraci√≥n.</p>
      </div>
      <div class="value-card">
        <div class="icon">üè≠</div>
        <h4>Producci√≥n local</h4>
        <p>Apoyamos talleres y proveedores nacionales.</p>
      </div>
      <div class="value-card">
        <div class="icon">üîí</div>
        <h4>Calidad</h4>
        <p>Materiales seguros y duraderos.</p>
      </div>
    </section>
  </main>

  <div id="footer-container"></div>

  <script>
    // Carrusel destacado - versi√≥n mejorada (flechas discretas, overlay en m√≥vil, swipe)
    (function(){
      const carouselEl = document.getElementById('carousel');
      const dotsEl = document.getElementById('carouselDots');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      let slides = [];
      let current = 0;

      async function loadSlides() {
        try {
          const res = await fetch('productos.json');
          if (!res.ok) return;
          const productos = await res.json();
          slides = productos.slice(0, 4);
          if (slides.length === 0) {
            carouselEl.innerHTML = '<div style="padding:2rem; text-align:center;">No hay productos destacados.</div>';
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            return;
          }
          renderSlide(current);
          renderDots();
          attachEvents();
        } catch (err) {
          console.error('Error cargando productos destacados:', err);
        }
      }

      function renderSlide(index) {
        const prod = slides[index];
        carouselEl.innerHTML = `
          <article class="slide" data-index="${index}">
            <div class="slide-media" aria-hidden="false">
              <img class="slide-img-click" src="${prod.imagen || 'placeholder.jpg'}" alt="${prod.nombre}">
              <div class="media-overlay" aria-hidden="false">
                <div class="overlay-title">${prod.nombre}</div>
                <div class="overlay-actions">
                  <div class="overlay-price">$${(prod.precio || 0).toLocaleString()}</div>
                  <button class="overlay-add" data-nombre="${prod.nombre}" data-precio="${prod.precio || 0}">A√±adir</button>
                </div>
              </div>
            </div>
            <div class="slide-content" aria-hidden="false">
              <h3 class="slide-title">${prod.nombre}</h3>
              <p class="slide-desc">${prod.descripcion || ''}</p>
              <div class="slide-actions" aria-hidden="false">
                <button class="add-btn" data-nombre="${prod.nombre}" data-precio="${prod.precio || 0}">üõí A√±adir al carrito</button>
                <div class="precio">$${(prod.precio || 0).toLocaleString()}</div>
              </div>
            </div>
          </article>
        `;

        const img = carouselEl.querySelector('.slide-img-click');
        if (img) {
          img.style.cursor = 'pointer';
          img.addEventListener('click', () => {
            const targetPage = (prod.categoria && prod.categoria.toLowerCase() === 'decoracion') ? 'decoracion.html'
                              : (prod.categoria && prod.categoria.toLowerCase() === 'juegos') ? 'juegos.html'
                              : 'catalogo.html';
            const url = `${targetPage}?expand=${encodeURIComponent(prod.nombre)}`;
            window.location.href = url;
          });
        }

        const dotButtons = dotsEl.querySelectorAll('button');
        dotButtons.forEach((b,i)=> b.classList.toggle('active', i===index));
      }

      function renderDots() {
        dotsEl.innerHTML = '';
        slides.forEach((s, i) => {
          const btn = document.createElement('button');
          btn.setAttribute('aria-label', 'Ir al producto ' + (i+1));
          btn.addEventListener('click', () => {
            goTo(i);
          });
          if (i===0) btn.classList.add('active');
          dotsEl.appendChild(btn);
        });
      }

      function goTo(i) {
        if (i < 0) i = slides.length - 1;
        if (i >= slides.length) i = 0;
        current = i;
        renderSlide(current);
      }

      function next() { goTo(current + 1); }
      function prev() { goTo(current - 1); }

      function attachEvents() {
        nextBtn.addEventListener('click', next);
        prevBtn.addEventListener('click', prev);

        window.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowRight') next();
          if (e.key === 'ArrowLeft') prev();
        });

        carouselEl.addEventListener('click', (e) => {
          const overlayBtn = e.target.closest('.overlay-add');
          const addBtn = e.target.closest('.add-btn');
          const btn = overlayBtn || addBtn;
          if (btn) {
            const nombre = btn.dataset.nombre;
            const precio = parseFloat(btn.dataset.precio || 0);
            alert(`Agregando al carrito: ${nombre} por $${precio.toLocaleString()}`);
            // Aqu√≠ puedes llamar funci√≥n para agregar al carrito real
          }
        });

        let touchStartX = null;
        let touchEndX = null;
        carouselEl.addEventListener('touchstart', (e) => {
          touchStartX = e.changedTouches[0].screenX;
        });
        carouselEl.addEventListener('touchend', (e) => {
          touchEndX = e.changedTouches[0].screenX;
          if (touchStartX - touchEndX > 40) next();
          else if (touchEndX - touchStartX > 40) prev();
        });
      }

      loadSlides();
    })();
  </script>
  <div id="footer-container"></div>
  <script type="module" src="script.js"></script>
  <script type="module">
    import { cargarProductos } from './script.js';
    document.addEventListener('DOMContentLoaded', () => {
        // Cargamos los productos en el index
        cargarProductos(); 
    });
  </script>

  <script type="module">
    // Importamos la funci√≥n de seguridad
    import { manejarClickAgregarAlCarrito } from './script.js';

    (function(){
      const carouselEl = document.getElementById('carousel');
      const dotsEl = document.getElementById('carouselDots');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      let slides = [];
      let current = 0;

      async function loadSlides() {
        try {
          const res = await fetch('productos.json');
          if (!res.ok) return;
          const productos = await res.json();
          slides = productos.slice(0, 4);
          
          if (slides.length === 0) {
            if(carouselEl) carouselEl.innerHTML = '<div style="padding:2rem; text-align:center;">No hay productos destacados.</div>';
            if(prevBtn) prevBtn.style.display = 'none';
            if(nextBtn) nextBtn.style.display = 'none';
            return;
          }
          renderSlide(current);
          renderDots();
          attachEvents();
        } catch (err) {
          console.error('Error cargando productos destacados:', err);
        }
      }

      function renderSlide(index) {
        if(!carouselEl) return;
        const prod = slides[index];
        carouselEl.innerHTML = `
          <article class="slide" data-index="${index}">
            <div class="slide-media">
              <img class="slide-img-click" src="${prod.imagen || 'placeholder.jpg'}" alt="${prod.nombre}">
              <div class="media-overlay">
                <div class="overlay-title">${prod.nombre}</div>
                <div class="overlay-actions">
                  <div class="overlay-price">$${(prod.precio || 0).toLocaleString()}</div>
                  <button class="overlay-add" data-nombre="${prod.nombre}" data-precio="${prod.precio || 0}">A√±adir</button>
                </div>
              </div>
            </div>
            <div class="slide-content">
              <h3 class="slide-title">${prod.nombre}</h3>
              <p class="slide-desc">${prod.descripcion || ''}</p>
              <div class="slide-actions">
                <button class="add-btn" data-nombre="${prod.nombre}" data-precio="${prod.precio || 0}">üõí A√±adir al carrito</button>
                <div class="precio">$${(prod.precio || 0).toLocaleString()}</div>
              </div>
            </div>
          </article>
        `;

        // Click en imagen -> detalle
        const img = carouselEl.querySelector('.slide-img-click');
        if (img) {
          img.style.cursor = 'pointer';
          img.addEventListener('click', () => {
            const targetPage = (prod.categoria && prod.categoria.toLowerCase() === 'decoracion') ? 'decoracion.html'
                             : (prod.categoria && prod.categoria.toLowerCase() === 'juegos') ? 'juegos.html'
                             : 'catalogo.html';
            const url = `${targetPage}?expand=${encodeURIComponent(prod.nombre)}`;
            window.location.href = url;
          });
        }

        if(dotsEl) {
            const dotButtons = dotsEl.querySelectorAll('button');
            dotButtons.forEach((b,i)=> b.classList.toggle('active', i===index));
        }
      }

      function renderDots() {
        if(!dotsEl) return;
        dotsEl.innerHTML = '';
        slides.forEach((s, i) => {
          const btn = document.createElement('button');
          btn.setAttribute('aria-label', 'Ir al producto ' + (i+1));
          btn.addEventListener('click', () => { goTo(i); });
          if (i===0) btn.classList.add('active');
          dotsEl.appendChild(btn);
        });
      }

      function goTo(i) {
        if (i < 0) i = slides.length - 1;
        if (i >= slides.length) i = 0;
        current = i;
        renderSlide(current);
      }

      function next() { goTo(current + 1); }
      function prev() { goTo(current - 1); }

      function attachEvents() {
        if(nextBtn) nextBtn.addEventListener('click', next);
        if(prevBtn) prevBtn.addEventListener('click', prev);

        window.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowRight') next();
          if (e.key === 'ArrowLeft') prev();
        });

        if(carouselEl) {
            carouselEl.addEventListener('click', (e) => {
              const overlayBtn = e.target.closest('.overlay-add');
              const addBtn = e.target.closest('.add-btn');
              const btn = overlayBtn || addBtn;
              
              if (btn) {
                const nombre = btn.dataset.nombre;
                const precio = parseFloat(btn.dataset.precio || 0);
                
                // ‚úÖ USAMOS LA FUNCI√ìN SEGURA DEL M√ìDULO
                manejarClickAgregarAlCarrito({ nombre, precio });
              }
            });

            let touchStartX = null;
            let touchEndX = null;
            carouselEl.addEventListener('touchstart', (e) => {
              touchStartX = e.changedTouches[0].screenX;
            });
            carouselEl.addEventListener('touchend', (e) => {
              touchEndX = e.changedTouches[0].screenX;
              if (touchStartX - touchEndX > 40) next();
              else if (touchEndX - touchStartX > 40) prev();
            });
        }
      }

      loadSlides();
    })();
  </script>
</body>
</html>
</body>
</html>
